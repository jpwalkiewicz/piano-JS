<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Vanilla JS piano</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<div class="wrapper">
  <div class="piano">
    <div data-key="65" class="key key-white">
      <kbd>a</kbd>
    </div>
    <div data-key="83" class="key key-white">
      <kbd>s</kbd>
    </div>
    <div data-key="68" class="key key-white">
      <kbd>d</kbd>
    </div>
    <div data-key="70" class="key key-white">
      <kbd>f</kbd>
    </div>
    <div data-key="71" class="key key-white">
      <kbd>g</kbd>
    </div>
    <div data-key="72" class="key key-white">
      <kbd>h</kbd>
    </div>
    <div data-key="74" class="key key-white">
      <kbd>j</kbd>
    </div>
    <div data-key="87" class="key key-black key-black-1">
      <kbd>w</kbd>
    </div>
    <div data-key="69" class="key key-black key-black-2">
      <kbd>e</kbd>
    </div>
    <div data-key="84" class="key key-black key-black-3">
      <kbd>t</kbd>
    </div>
    <div data-key="89" class="key key-black key-black-4">
      <kbd>y</kbd>
    </div>
    <div data-key="85" class="key key-black key-black-5">
      <kbd>u</kbd>
    </div>

  </div>
  <div class="panel">
    <button onclick="startRecording()" class="btn-panel">
      <span id="record" class="btn-record panel-icons ">●</span>Record
    </button>
    <button disabled id="btn-play" onclick="playSong()" class="btn-panel"><span class="panel-icons">▶</span>Play</button>
    <button disabled id="btn-reset" onclick="recordReset()" class="btn-panel"><span class="panel-icons">◼</span><span id="reset">Stop</span>
    </button>
  </div>
</div>

<audio data-key="65" src="sounds/C1.wav"></audio>
<audio data-key="83" src="sounds/D1.wav"></audio>
<audio data-key="68" src="sounds/E1.wav"></audio>
<audio data-key="70" src="sounds/F1.wav"></audio>
<audio data-key="71" src="sounds/G1.wav"></audio>
<audio data-key="72" src="sounds/D1.wav"></audio>
<audio data-key="74" src="sounds/E1.wav"></audio>
<audio data-key="89" src="sounds/C1.wav"></audio>
<audio data-key="87" src="sounds/F1.wav"></audio>
<audio data-key="69" src="sounds/F1.wav"></audio>
<audio data-key="84" src="sounds/D1.wav"></audio>
<audio data-key="85" src="sounds/E1.wav"></audio>

<script>

  const keys = document.querySelectorAll('.key');
  const recordedSounds = [];
  const recordButtonText = document.getElementById('record');
  const resetButtonText = document.getElementById('reset');
  const playButton = document.getElementById('btn-play');
  const resetButton = document.getElementById('btn-reset');
  var isRecording = false;
  var toReset = false;

  playSong = () => {
    recordedSounds.forEach(song => {
      const audio = document.querySelector(`audio[data-key="${song}"]`);
      audio.play();
    })
  };

  startRecording = () => {
    isRecording = true;
    toReset = false;
    resetButtonText.innerText = 'Stop';
    recordButtonText.classList.add('active-record');
    playButton.disabled = false;
    resetButton.disabled = false;
  };

  recordReset = () => {
    resetButtonText.innerText = 'Reset';
    if (toReset) {
      recordedSounds.length = 0;
      resetButtonText.innerText = 'Stop';
      playButton.disabled = true;
      resetButton.disabled = true;
    }
    isRecording = false;
    toReset = true;
    recordButtonText.classList.remove('active-record');
    keys.forEach(key => {
      key.classList.remove('playing');
    });
  };

  function playSound(e) {
    const audio = document.querySelector(`audio[data-key="${e.keyCode}"]`);
    const key = document.querySelector(`.key[data-key="${e.keyCode}"]`);
    if (!audio) return;
    if (isRecording) {
      recordedSounds.push(e.keyCode);
    }
    console.log(recordedSounds);
    audio.currentTime = 0;
    audio.play();
    key.classList.add('playing');
  }

  function clickKey() {
    const keyCode = this.getAttribute('data-key');
    const audio = document.querySelector(`audio[data-key="${keyCode}"]`);
    if (isRecording) {
      recordedSounds.push(Number(keyCode));
    }
    audio.currentTime = 0;
    audio.play();
    this.classList.add('playing');
  }

  function removeTransition(e) {
    if (e.propertyName !== 'height') return;
    this.classList.remove('playing');
  }

  keys.forEach(key => {
    key.addEventListener('click', clickKey);
    key.addEventListener('transitionend', removeTransition);
  });

  window.addEventListener('keydown', playSound);

</script>


</body>

</html>